<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ | üåµ Cactus Shop</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #c8e6c9 0%, #81c784 50%, #66bb6a 100%);
        }

        .header {
            background: linear-gradient(135deg, #66bb6a 0%, #4caf50 50%, #388e3c 100%);
            color: white;
            padding: 2rem 5%;
            text-align: center;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        .header h1 {
            font-size: 2rem;
            margin-bottom: 0.5rem;
        }

        .user-info {
            opacity: 0.9;
            margin-top: 0.5rem;
        }

        .container {
            max-width: 1200px;
            margin: 2rem auto;
            padding: 0 2rem;
        }

        .nav-buttons {
            display: flex;
            gap: 1rem;
            margin-bottom: 2rem;
            flex-wrap: wrap;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 500;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .btn-back {
            background-color: #95a5a6;
            color: white;
        }

        .btn-checkout {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
            color: white;
            margin-left: auto;
        }

        .btn-checkout:disabled {
            background: #bdc3c7;
            cursor: not-allowed;
            transform: none;
        }

        .cart-container {
            background: white;
            border-radius: 15px;
            padding: 2rem;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.08);
        }

        .empty-cart {
            text-align: center;
            padding: 3rem;
            color: #7f8c8d;
        }

        .empty-cart i {
            font-size: 5rem;
            margin-bottom: 1rem;
            opacity: 0.3;
        }

        .cart-item {
            display: grid;
            grid-template-columns: 100px 1fr auto;
            gap: 1.5rem;
            padding: 1.5rem;
            border-bottom: 1px solid #ecf0f1;
            align-items: center;
        }

        .cart-item:last-child {
            border-bottom: none;
        }

        .cart-item img {
            width: 100px;
            height: 100px;
            object-fit: cover;
            border-radius: 10px;
        }

        .item-details h3 {
            color: #388e3c;
            margin-bottom: 0.5rem;
            font-size: 1.1rem;
        }

        .item-price {
            color: #4caf50;
            font-size: 1.1rem;
            font-weight: bold;
            margin-top: 0.5rem;
        }

        .item-subtotal {
            color: #7f8c8d;
            font-size: 0.9rem;
            margin-top: 0.25rem;
        }

        .item-controls {
            display: flex;
            flex-direction: column;
            align-items: flex-end;
            gap: 1rem;
        }

        .quantity-control {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            background: #f8f9fa;
            padding: 0.5rem;
            border-radius: 8px;
        }

        .quantity-btn {
            width: 35px;
            height: 35px;
            border: none;
            background: #4caf50;
            color: white;
            border-radius: 5px;
            cursor: pointer;
            font-size: 18px;
            transition: all 0.3s;
        }

        .quantity-btn:hover {
            background: #229954;
            transform: scale(1.1);
        }

        .quantity-btn:disabled {
            background: #bdc3c7;
            cursor: not-allowed;
            transform: none;
        }

        .quantity {
            min-width: 40px;
            text-align: center;
            font-weight: bold;
            font-size: 1.1rem;
        }

        .remove-btn {
            background: #e74c3c;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .remove-btn:hover {
            background: #c0392b;
            transform: scale(1.05);
        }

        .stock-warning {
            color: #e74c3c;
            font-size: 0.85rem;
            margin-top: 0.25rem;
        }

        .cart-summary {
            margin-top: 2rem;
            padding-top: 2rem;
            border-top: 2px solid #ecf0f1;
        }

        .summary-row {
            display: flex;
            justify-content: space-between;
            padding: 0.75rem 0;
            font-size: 1.1rem;
        }

        .summary-row.total {
            font-size: 1.5rem;
            font-weight: bold;
            color: #388e3c;
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 2px solid #4caf50;
        }

        .total-price {
            color: #4caf50;
        }

        .toast {
            position: fixed;
            bottom: 30px;
            right: 30px;
            background: linear-gradient(135deg, #4caf50, #229954);
            color: white;
            padding: 16px 24px;
            border-radius: 12px;
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.3);
            display: flex;
            align-items: center;
            gap: 12px;
            font-weight: 500;
            transform: translateX(400px);
            transition: transform 0.4s ease;
            z-index: 1000;
        }

        .toast.show {
            transform: translateX(0);
        }

        .toast.error {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
        }

        /* Checkout Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 2000;
            justify-content: center;
            align-items: center;
            padding: 1rem;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            padding: 2rem;
            border-radius: 12px;
            max-width: 500px;
            width: 100%;
            text-align: center;
        }

        .modal-icon {
            font-size: 4rem;
            color: #4caf50;
            margin-bottom: 1rem;
        }

        .modal-content h2 {
            color: #388e3c;
            margin-bottom: 1rem;
        }

        .modal-content p {
            color: #7f8c8d;
            margin-bottom: 1.5rem;
            line-height: 1.6;
        }

        .order-id {
            background: #f8f9fa;
            padding: 1rem;
            border-radius: 8px;
            margin: 1rem 0;
            font-family: monospace;
            font-size: 1.2rem;
            font-weight: bold;
            color: #4caf50;
        }

        @media (max-width: 768px) {
            .cart-item {
                grid-template-columns: 80px 1fr;
                gap: 1rem;
            }

            .item-controls {
                grid-column: 1 / -1;
                flex-direction: row;
                justify-content: space-between;
                align-items: center;
            }

            .summary-row {
                font-size: 1rem;
            }

            .summary-row.total {
                font-size: 1.3rem;
            }
        }
    
        .decorative-cactus {
            position: fixed;
            font-size: 4rem;
            opacity: 0.1;
            pointer-events: none;
            z-index: 0;
        }
        .decorative-cactus:nth-child(1) {
            top: 10%;
            left: 5%;
            animation: float-cactus 4s ease-in-out infinite;
        }
        .decorative-cactus:nth-child(2) {
            top: 60%;
            right: 8%;
            animation: float-cactus 5s ease-in-out infinite 1s;
        }
        .decorative-cactus:nth-child(3) {
            bottom: 15%;
            left: 10%;
            animation: float-cactus 6s ease-in-out infinite 2s;
        }
        @keyframes float-cactus {
            0%, 100% { transform: translateY(0) rotate(-5deg); }
            50% { transform: translateY(-12px) rotate(5deg); }
        }
</style>
</head>
<body>
    <div class="decorative-cactus">üåµ</div>
    <div class="decorative-cactus">üåµ</div>
    <div class="decorative-cactus">üåµ</div>

    <div class="header">
        <h1>üõí ‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</h1>
        <p>‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏•‡∏∑‡∏≠‡∏Å</p>
        <p class="user-info" id="user-info"></p>
    </div>

    <div class="container">
        <div class="nav-buttons">
            <button onclick="location.href='products.html'" class="btn btn-back">
                <i class="fas fa-arrow-left"></i> ‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤
            </button>
            <button onclick="confirmOrder()" class="btn btn-checkout" id="checkout-btn">
                <i class="fas fa-check-circle"></i> ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠
            </button>
        </div>

        <div class="cart-container">
            <div id="cart-items"></div>
            <div id="cart-summary" style="display: none;">
                <div class="cart-summary">
                    <div class="summary-row">
                        <span>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</span>
                        <span id="total-items">0 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</span>
                    </div>
                    <div class="summary-row total">
                        <span>‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</span>
                        <span class="total-price" id="total-price">‡∏ø0</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Success Modal -->
    <div class="modal" id="success-modal">
        <div class="modal-content">
            <div class="modal-icon">
                <i class="fas fa-check-circle"></i>
            </div>
            <h2>‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!</h2>
            <p>‡∏Ç‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£ Cactus Shop üåµ</p>
            <div class="order-id" id="order-id-display"></div>
            <p>‡∏Ñ‡∏∏‡∏ì‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡πÑ‡∏î‡πâ‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö</p>
            <button class="btn btn-checkout" onclick="closeModal()">
                <i class="fas fa-home"></i> ‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å
            </button>
        </div>
    </div>

    <div class="toast" id="toast">
        <i class="fas fa-check-circle"></i>
        <span id="toast-message"></span>
    </div>

    <script>
        // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô
        function checkLoginOnLoad() {
            const isLoggedIn = localStorage.getItem('isLoggedIn') === 'true';
            const username = localStorage.getItem('username');
            
            if (!isLoggedIn) {
                alert('‚ö†Ô∏è ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á‡∏´‡∏ô‡πâ‡∏≤‡∏ô‡∏µ‡πâ\n\n‡∏Ñ‡∏∏‡∏ì‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏ô‡∏≥‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡∏´‡∏ô‡πâ‡∏≤‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô');
                window.location.href = 'login.php';
                return false;
            }

            // ‡πÅ‡∏™‡∏î‡∏á‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ
            document.getElementById('user-info').textContent = `üëã ‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ, ${username}`;
            return true;
        }

        // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÅ‡∏•‡∏∞‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏™‡∏ï‡πá‡∏≠‡∏Å‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤
        function validateCartStock() {
            const cart = JSON.parse(localStorage.getItem('cart')) || [];
            const products = JSON.parse(localStorage.getItem('products')) || [];
            let hasChanges = false;
            let warnings = [];

            const validCart = cart.map(item => {
                const product = products.find(p => p.id == item.id);
                
                if (!product) {
                    warnings.push(`${item.name} ‡πÑ‡∏°‡πà‡∏û‡∏ö‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏•‡πâ‡∏ß`);
                    hasChanges = true;
                    return null;
                }

                if (product.stock === 0) {
                    warnings.push(`${item.name} ‡∏´‡∏°‡∏î‡∏™‡∏ï‡πá‡∏≠‡∏Å‡πÅ‡∏•‡πâ‡∏ß`);
                    hasChanges = true;
                    return null;
                }

                if (item.quantity > product.stock) {
                    warnings.push(`${item.name} ‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡πÄ‡∏û‡∏µ‡∏¢‡∏á ${product.stock} ‡∏ä‡∏¥‡πâ‡∏ô ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÉ‡∏ô‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤‡∏ñ‡∏π‡∏Å‡∏õ‡∏£‡∏±‡∏ö‡πÉ‡∏´‡πâ‡πÄ‡∏ó‡πà‡∏≤‡∏Å‡∏±‡∏ö‡∏™‡∏ï‡πá‡∏≠‡∏Å`);
                    item.quantity = product.stock;
                    hasChanges = true;
                }

                return item;
            }).filter(item => item !== null);

            if (hasChanges) {
                localStorage.setItem('cart', JSON.stringify(validCart));
                if (warnings.length > 0) {
                    showToast('‚ö†Ô∏è ' + warnings.join(', '), true);
                }
            }

            return validCart;
        }

        // ‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏ô‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤
        function displayCart() {
            if (!checkLoginOnLoad()) return;

            const cart = validateCartStock();
            const cartItemsDiv = document.getElementById('cart-items');
            const cartSummaryDiv = document.getElementById('cart-summary');
            const checkoutBtn = document.getElementById('checkout-btn');
            const products = JSON.parse(localStorage.getItem('products')) || [];
            
            if (cart.length === 0) {
                cartItemsDiv.innerHTML = `
                    <div class="empty-cart">
                        <i class="fas fa-shopping-basket"></i>
                        <h2>‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ß‡πà‡∏≤‡∏á‡πÄ‡∏õ‡∏•‡πà‡∏≤</h2>
                        <p>‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£</p>
                    </div>
                `;
                cartSummaryDiv.style.display = 'none';
                checkoutBtn.disabled = true;
                return;
            }

            cartSummaryDiv.style.display = 'block';
            checkoutBtn.disabled = false;
            
            let html = '';
            let total = 0;
            let totalItems = 0;

            cart.forEach(item => {
                const product = products.find(p => p.id == item.id);
                const itemTotal = item.price * item.quantity;
                total += itemTotal;
                totalItems += item.quantity;

                const maxQuantity = product ? product.stock : item.quantity;
                const stockWarning = product && item.quantity >= product.stock 
                    ? `<div class="stock-warning">‚ö†Ô∏è ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î‡∏ó‡∏µ‡πà‡∏™‡∏±‡πà‡∏á‡πÑ‡∏î‡πâ</div>` 
                    : '';

                html += `
                    <div class="cart-item">
                        <img src="${item.image}" alt="${item.name}">
                        <div class="item-details">
                            <h3>${item.name}</h3>
                            <div class="item-price">‡∏ø${item.price.toLocaleString()} / ‡∏ä‡∏¥‡πâ‡∏ô</div>
                            <div class="item-subtotal">‡∏£‡∏ß‡∏°: ‡∏ø${itemTotal.toLocaleString()}</div>
                            ${stockWarning}
                        </div>
                        <div class="item-controls">
                            <div class="quantity-control">
                                <button class="quantity-btn" onclick="updateQuantity('${item.id}', -1)">
                                    <i class="fas fa-minus"></i>
                                </button>
                                <span class="quantity">${item.quantity}</span>
                                <button class="quantity-btn" onclick="updateQuantity('${item.id}', 1)" 
                                    ${item.quantity >= maxQuantity ? 'disabled' : ''}>
                                    <i class="fas fa-plus"></i>
                                </button>
                            </div>
                            <button class="remove-btn" onclick="removeItem('${item.id}')">
                                <i class="fas fa-trash"></i> ‡∏•‡∏ö
                            </button>
                        </div>
                    </div>
                `;
            });

            cartItemsDiv.innerHTML = html;
            document.getElementById('total-price').textContent = `‡∏ø${total.toLocaleString()}`;
            document.getElementById('total-items').textContent = `${totalItems} ‡∏ä‡∏¥‡πâ‡∏ô`;
        }

        // ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤
        function updateQuantity(productId, change) {
            let cart = JSON.parse(localStorage.getItem('cart')) || [];
            const products = JSON.parse(localStorage.getItem('products')) || [];
            const item = cart.find(i => i.id == productId);
            const product = products.find(p => p.id == productId);
            
            if (item) {
                const newQuantity = item.quantity + change;

                if (newQuantity <= 0) {
                    cart = cart.filter(i => i.id != productId);
                } else if (product && newQuantity > product.stock) {
                    showToast(`‚ö†Ô∏è ‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏™‡∏ï‡πá‡∏≠‡∏Å‡πÄ‡∏û‡∏µ‡∏¢‡∏á ${product.stock} ‡∏ä‡∏¥‡πâ‡∏ô`, true);
                    return;
                } else {
                    item.quantity = newQuantity;
                }
                
                localStorage.setItem('cart', JSON.stringify(cart));
                displayCart();
            }
        }

        // ‡∏•‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤
        function removeItem(productId) {
            if (confirm('‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ô‡∏µ‡πâ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?')) {
                let cart = JSON.parse(localStorage.getItem('cart')) || [];
                cart = cart.filter(i => i.id != productId);
                localStorage.setItem('cart', JSON.stringify(cart));
                displayCart();
                showToast('‡∏•‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤‡πÅ‡∏•‡πâ‡∏ß');
            }
        }

        // ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠
        function confirmOrder() {
            const cart = JSON.parse(localStorage.getItem('cart')) || [];
            
            if (cart.length === 0) {
                showToast('‚ö†Ô∏è ‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ß‡πà‡∏≤‡∏á‡πÄ‡∏õ‡∏•‡πà‡∏≤', true);
                return;
            }

            // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠
            const orders = JSON.parse(localStorage.getItem('orders')) || [];
            const username = localStorage.getItem('username');
            const total = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            
            const newOrder = {
                id: 'ORD' + Date.now(),
                username: username,
                items: cart,
                total: total,
                status: 'pending',
                orderDate: new Date().toISOString()
            };

            orders.push(newOrder);
            localStorage.setItem('orders', JSON.stringify(orders));

            // ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏™‡∏ï‡πá‡∏≠‡∏Å‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤
            updateProductStock(cart);

            // ‡∏•‡πâ‡∏≤‡∏á‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤
            localStorage.removeItem('cart');

            // ‡πÅ‡∏™‡∏î‡∏á Modal ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à
            document.getElementById('order-id-display').textContent = newOrder.id;
            document.getElementById('success-modal').classList.add('active');
        }

        // ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏™‡∏ï‡πá‡∏≠‡∏Å‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏á‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠
        function updateProductStock(cart) {
            const products = JSON.parse(localStorage.getItem('products')) || [];
            
            cart.forEach(cartItem => {
                const product = products.find(p => p.id == cartItem.id);
                if (product) {
                    product.stock -= cartItem.quantity;
                    if (product.stock < 0) product.stock = 0;
                }
            });

            localStorage.setItem('products', JSON.stringify(products));
        }

        // ‡∏õ‡∏¥‡∏î Modal
        function closeModal() {
            document.getElementById('success-modal').classList.remove('active');
            window.location.href = 'products.html';
        }

        // ‡πÅ‡∏™‡∏î‡∏á Toast
        let toastTimeout = null;
        function showToast(message, isError = false) {
            const toast = document.getElementById('toast');
            const toastIcon = toast.querySelector('i');
            
            document.getElementById('toast-message').textContent = message;
            
            if (isError) {
                toast.classList.add('error');
                toastIcon.className = 'fas fa-exclamation-circle';
            } else {
                toast.classList.remove('error');
                toastIcon.className = 'fas fa-check-circle';
            }

            if (toast.classList.contains('show')) {
                clearTimeout(toastTimeout);
            } else {
                toast.classList.add('show');
            }

            toastTimeout = setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        }

        // ‡πÇ‡∏´‡∏•‡∏î‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤
        window.addEventListener('DOMContentLoaded', displayCart);

        // ‡∏£‡∏µ‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á‡∏™‡∏ï‡πá‡∏≠‡∏Å
        window.addEventListener('storage', function(e) {
            if (e.key === 'products' || e.key === 'cart') {
                displayCart();
            }
        });
    </script>
</body>
</html>